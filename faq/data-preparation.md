# 데이터 준비 및 전처리

LLM을 from scratch로 학습할 때 **데이터 포맷이 모델의 능력을 결정**합니다.

---

## 한 줄 요약

> **"요약 능력 = 알고리즘이 아니라 데이터 포맷으로 만든다"**

---

## 1. 원본 데이터 요구사항

### 파일 규격

| 항목 | 권장값 |
|------|--------|
| 인코딩 | **UTF-8** (필수) |
| 파일 크기 | 10MB ~ 100MB |
| 형식 | 텍스트 (.txt) |

### 데이터 품질 가이드

**좋은 데이터:**
- 구인/구직 정보가 포함된 자연어 문장
- 기관/회사/서비스 설명 텍스트
- 구조화된 정보 (회사명, 포지션, 연봉 등)

**품질이 떨어지는 데이터:**
- 코드/로그만 있는 데이터
- 이모지/URL/해시태그가 과도한 데이터
- 문장 패턴이 너무 단조롭거나 깨진 데이터

---

## 2. 학습 데이터 포맷 (핵심!)

### 왜 "질문→답변" 구조가 필요한가?

LLM 학습의 핵심 원리:

```
모델은 "다음 토큰 예측"을 학습한다
    ↓
데이터에 "질문 다음에 답변이 온다"는 패턴이 반복되면
    ↓
모델이 "질문이 주어지면 답변을 생성한다"는 능력을 습득
```

| 데이터 형식 | 모델이 학습하는 능력 |
|-------------|---------------------|
| 단순 텍스트 나열 | 텍스트 이어쓰기만 잘함 |
| 질문→답변 구조 | **질문에 답변하는 능력** |
| 문서→요약 구조 | **요약하는 능력** |

### JAI 추천 템플릿

```
[QUESTION]
{질문}
[/QUESTION]

[DOC]
{원본 문서 내용}
[/DOC]

[ANSWER]
요약:
- {핵심 포인트 3~7개}

체크리스트:
- 해야 할 일:
  - (1) 핵심 행동 1
  - (2) 핵심 행동 2
- 준비물:
  - (1) 필요한 서류/정보
- 주의사항:
  - (1) 실수하기 쉬운 점

구인 정보:
- 회사명: ...
  - 포지션: ...
  - 연봉: ...
  - TEL: ...
  - WEB: ...

상세 설명:
{자세한 설명}
[/ANSWER]
```

---

## 3. 형식의 자유도

### 진짜 지켜야 할 것: 일관성

| 항목 | 필수 여부 | 설명 |
|------|-----------|------|
| 특정 태그 형식 | ❌ 아님 | `[QUESTION]` 대신 `Q:` 가능 |
| **일관된 형식** | ✅ 필수 | 모든 샘플이 동일한 패턴 |
| **입력→출력 구조** | ✅ 권장 | 모델이 "답변 능력"을 학습하려면 필요 |

### 다른 형식 예시 (모두 가능)

```
# 형식 1: 간단한 Q/A
Q: 질문
A: 답변

# 형식 2: 마크다운 스타일
### 질문
질문 내용
### 답변
답변 내용

# 형식 3: ChatML 스타일
<|user|>질문<|assistant|>답변

# 형식 4: 자연어
사용자: 질문
JAI: 답변

# 형식 5: 구분자 스타일
---QUESTION---
질문
---ANSWER---
답변
```

> **핵심**: 형식 자체는 자유지만, **"입력→출력" 패턴**과 **일관성**이 중요합니다.

---

## 4. 전처리 스크립트 개요

### 스크립트의 핵심 목적

```
raw.txt (원본 텍스트)
    ↓ prepare_samples.py (변환 로직)
samples.txt ([QUESTION]...[ANSWER] 형식)
```

> **중요**: 스크립트는 **예시**일 뿐입니다. 본인의 데이터에 맞게 **100% 자유롭게 커스터마이징** 가능합니다!

### 자유로운 것 (변환 로직)

| 항목 | 자유도 | 설명 |
|------|--------|------|
| `raw.txt` 형식 | ✅ 완전 자유 | JSON, CSV, XML, TXT 등 |
| 파싱 로직 | ✅ 완전 자유 | 정규식, 파서, 수동 작성 등 |
| 질문 생성 방식 | ✅ 완전 자유 | 템플릿, 랜덤, 규칙 기반 등 |
| 답변 포맷 | ✅ 완전 자유 | 요약, 체크리스트, 표 등 |
| `samples.txt` 직접 작성 | ✅ 가능 | 스크립트 없이 수작업도 OK |

---

## 5. 데이터 양에 따른 추천

| 데이터 양 | 추천 방법 |
|-----------|-----------|
| 20개 미만 | `samples.txt` **직접 수작업** 작성 |
| 20~100개 | **간단한 스크립트** + 수동 검수 |
| 100개 이상 | **자동화 스크립트** 필수, 샘플 검수 |

---

## 6. 샘플 수와 품질의 관계

| 샘플 수 | 기대 효과 |
|---------|-----------|
| 3,000개 | "되는 느낌" - 형식이 어느 정도 나옴 |
| 10,000개 | "형식이 안정" - 일관된 출력 |
| 30,000개 | "요약/정리 습관 강해짐" - 고품질 출력 |

---

## 7. 실행 방법

```bash
# data/raw.txt 파일이 준비되었는지 확인
ls data/raw.txt

# 전처리 스크립트 실행
uv run python scripts/prepare_samples.py
```

### 예상 출력

```
총 청크 수: 5000
저장 완료: data/samples.txt
```

---

## 8. 핵심 포인트

### 1. "한 문서당 1개의 요약 답변"을 만들어라

- raw.txt를 그대로 학습시키면 "텍스트 이어쓰기"만 잘함
- "질문→답변" 구조 샘플이 요약 능력을 만듦

### 2. 라벨을 표준화하라

```
# 변환 전
전화: 02-1234-5678
Tel: +82-2-1234-5678
☎️ 1234-5678

# 변환 후 (모두 통일)
TEL: 02-1234-5678
TEL: +82-2-1234-5678
TEL: 1234-5678
```

### 3. 다양한 질문 템플릿 사용

질문을 다양하게 작성할수록 모델이 다양한 질문에 대응할 수 있습니다.

---

## 요약

| 질문 | 답변 |
|------|------|
| 데이터 형식? | 자유, 단 일관성 필수 |
| 권장 형식? | [QUESTION]...[DOC]...[ANSWER] |
| 최소 샘플 수? | 3,000개 이상 권장 |
| 핵심 원칙? | 데이터 포맷 = 모델 능력 |

---

## 관련 문서

- [sample-data.md](sample-data.md) - 샘플 데이터 요구사항
- [sample-data-strategy.md](sample-data-strategy.md) - 샘플 데이터 구성 전략
- [bpe-algorithm.md](bpe-algorithm.md) - BPE 토크나이저 학습
